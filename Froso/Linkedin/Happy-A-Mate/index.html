<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Happy-A-Mate!</title>
  </head>

  <body>
    <h2>Please input your LinkedIn credentials</h2>
    <form>
      <input type = "text"     id = "email"    placeholder="Email" autofocus>&nbsp&nbsp&nbsp
      <input type = "password" id = "password" placeholder="Password"><br><br>
      <input type = "file"     id = "excel"    accept = ".xlsx"><br><br>
      Record range <em>(Default:first 200 records)</em>
      <input type = "number"   id = "start"    placeholder="Starting row">&nbsp&nbsp&nbsp
      <input type = "number"   id = "end"      placeholder="Ending row"><br><br>
      Current job Duration<em>(Default: 3 months)</em>
      <input type = "number"   id = "jobDuration"      placeholder="Add # of months"><br><br>
      <input type = "button"   id = "signin"   value = "Let's do it"><br><br>

      <span id = "currentlyVisitingProfile">Currently visiting profile:</span> 
      <span id = "currentProfile"></span> 
      <span id = "of"> of</span> 
      <span id = "totalProfiles"></span> 
      <br><br>
      <span id = "completed">Completed:</span>
      <span id = "recordsDonePercent">0</span>
      <span id = "percent">%</span>
      <br><br>
      <span id = "approximateTimeRemaining">Approximate time remaining:</span>
      <span id = "timeRemaining"></span>
      <span id = "mins">min(s)</span>
    </form>
    <script src="main.js"></script>
    
    <script>
      const {ipcRenderer} = require('electron')
      let email = "Null";
      let password = "Null";
      let excel = "Null";
      let startRow = "2";
      let endRow = "200";
      let jobDuration = "3";

      let totalNumberOfProfiles = "200";

      document.getElementById("signin").addEventListener('click', function() {
        email = document.getElementById("email").value;
        password = document.getElementById("password").value;

        if(document.getElementById("excel").files.length !=0){
          excel = document.getElementById("excel").files[0].path;          
        }
        else {
          readTextFile("/Users/Rohit/Documents/GitHub/HappyCo/Froso/Linkedin/Happy-A-Mate/config.json", function(text){
            var data = JSON.parse(text);
            if (data.file.path != null) {
              excel = data.file.path; 
            }
          });
        }
        startRow = document.getElementById("start").value;
        endRow = document.getElementById("end").value;
        jobDuration = document.getElementById("jobDuration").value;

        if (startRow == "" || startRow <= "1") {
          startRow = "2";
          document.getElementById("start").value = startRow;
        }
        if (endRow == "") {
          endRow = "200";
          document.getElementById("end").value = endRow;
        }

        if (jobDuration == "" || jobDuration > 11) {
          jobDuration = "3";
          document.getElementById("jobDuration").value = jobDuration;
        }
        
        totalNumberOfProfiles = endRow-startRow+1;
        
        totalProfiles.textContent = totalNumberOfProfiles;
        currentProfile.textContent = "-";
        var time = Math.round(parseInt((totalNumberOfProfiles/9.5)));
        if (time == 0) {
          time = "< 1";
        }
        timeRemaining.textContent = time;
        recordsDonePercent.textContent = "0"


        currentlyVisitingProfile.style.display = "inline";
        currentProfile.style.display = "inline";
        of.style.display = "inline";
        totalProfiles.style.display = "inline";
        completed.style.display = "inline";
        recordsDonePercent.style.display = "inline";
        percent.style.display = "inline";
        approximateTimeRemaining.style.display = "inline";
        timeRemaining.style.display = "inline";
        mins.style.display = "inline";
        
        ipcRenderer.send('email', email)
        ipcRenderer.send('password', password)
        ipcRenderer.send('excel', excel)
        ipcRenderer.send('start row', startRow)
        ipcRenderer.send('end row', endRow)
        ipcRenderer.send('job duration', jobDuration)
      });

      function func() {
        disableElements();
        smashIt();
      }

      function disableElements(element) {
        var elements = ["email", "password", "excel", "start", "end", "signin", "jobDuration"]
        for (var i = 0; i < elements.length; i++) {
          let element = document.getElementById(elements[i])
          element.disabled = true;
        }
      }
      
      document.getElementById("signin").addEventListener('click',function(){
        func();
      });
      // checking if the json value for row is not empty string, put it in start row
      // and same for excel path
      readTextFile("/Users/Rohit/Documents/GitHub/HappyCo/Froso/Linkedin/Happy-A-Mate/config.json", function(text){
          var data = JSON.parse(text);
          if (data.row != "") {
            document.getElementById("start").value = data.row;
          }

          if (data.file.path != "") {
            document.getElementById("excel").files[0].path = data.file.path;;
            // document.getElementById("excel").value = data.file.path;
          }
      });

    </script>
  </body>
</html>


